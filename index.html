<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-title" content="20/20 Scanner">
    <title>20/20 QR Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #ecf0f1;
            --text-color: #34495e;
            --vendor-pgw: #e74c3c;
            --vendor-pilkington: #f39c12;
            --vendor-mygrant: #9b59b6;
            --vendor-other: #1abc9c;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .header img {
            max-height: 50px;
        }

        .header h1 {
            color: var(--primary-color);
            font-weight: 700;
            margin: 0;
        }

        h2 {
            color: var(--primary-color);
            text-align: center;
            margin: 10px 0;
        }

        #qr-reader, #qr-reader-audit {
            width: 100%;
            max-width: 500px;
            margin: 20px 0;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #emailReportButton {
            background-color: var(--primary-color);
            color: white;
        }

        .email-button {
            background-color: var(--primary-color);
            color: white;
        }

        .sms-button {
            background-color: var(--secondary-color);
            color: white;
            margin-left: auto;
        }

        .inventory-section, .vendor-section {
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 5px;
        }

        #inventorySection {
            display: none;
        }

        #inventoryList, .vendor-list, #auditList {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #inventoryList li, .vendor-list li, #auditList li {
            background-color: white;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .item-content {
            white-space: pre-wrap;
            word-break: break-word;
        }

        .remove-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }

        .vendor-button-container {
            display: flex;
            justify-content: space-between;
        }

        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            animation: fadeInOut 2s ease-in-out;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            h1, h2 {
                font-size: 24px;
            }

            button {
                padding: 8px 16px;
                font-size: 14px;
            }

            #qr-reader, #qr-reader-audit {
                max-width: 300px;
            }
        }

        .hidden {
            display: none;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        #auditForm {
            width: 100%;
            max-width: 500px;
        }

        .edit-remove-buttons {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="2020-Logo-Color-150.png" alt="Logo">
        <h1>Warehouse QR Scanner</h1>
    </div>
    <div id="mainScreen">
        <button id="returnPartsButton">Return Parts</button>
        <button id="auditPartsButton">Audit Parts</button>
    </div>
    <div id="returnPartsScreen" class="hidden">
        <div id="qr-reader"></div>
        <div class="button-container">
            <button id="emailReportButton">Send Email Report</button>
        </div>
        <div id="inventorySection" class="inventory-section">
            <h2>Inventory Items</h2>
            <ul id="inventoryList"></ul>
            <div class="button-container">
                <button id="inventoryEmailButton" class="email-button">Email Inventory Report</button>
                <button id="inventorySmsButton" class="sms-button">SMS Inventory Report</button>
            </div>
        </div>
    </div>
    <div id="auditPartsScreen" class="hidden">
        <div id="qr-reader-audit"></div>
        <form id="auditForm">
            <div class="form-group">
                <label for="customer">Customer</label>
                <input type="text" id="customer">
            </div>
            <div class="form-group">
                <label for="part">Part</label>
                <input type="text" id="part">
            </div>
            <div class="form-group">
                <label for="supplier">Supplier</label>
                <input type="text" id="supplier">
            </div>
            <div class="form-group">
                <label for="order">Order</label>
                <input type="text" id="order">
            </div>
            <div class="form-group">
                <label for="labeled">Labeled Date</label>
                <input type="text" id="labeled">
            </div>
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location">
            </div>
            <button type="button" id="addItemButton">Add Item</button>
        </form>
        <div class="button-container">
            <button id="sortLocationButton">Sort by Location</button>
            <button id="sortDateButton">Sort by Date</button>
        </div>
        <ul id="auditList"></ul>
        <button id="emailAuditButton">Email Audit Report</button>
    </div>
    <div id="notification">Item Scanned!</div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const html5QrCodeConfig = { fps: 10, qrbox: { width: 250, height: 250 } };
            let html5QrCode = null;

            const mainScreen = document.getElementById('mainScreen');
            const returnPartsButton = document.getElementById('returnPartsButton');
            const auditPartsButton = document.getElementById('auditPartsButton');
            const returnPartsScreen = document.getElementById('returnPartsScreen');
            const auditPartsScreen = document.getElementById('auditPartsScreen');

            const emailReportButton = document.getElementById('emailReportButton');
            const inventoryEmailButton = document.getElementById('inventoryEmailButton');
            const inventorySmsButton = document.getElementById('inventorySmsButton');
            const inventoryList = document.getElementById('inventoryList');
            const auditForm = document.getElementById('auditForm');
            const auditList = document.getElementById('auditList');
            const addItemButton = document.getElementById('addItemButton');
            const sortLocationButton = document.getElementById('sortLocationButton');
            const sortDateButton = document.getElementById('sortDateButton');
            const emailAuditButton = document.getElementById('emailAuditButton');

            const scannedItems = new Set();
            const notification = document.getElementById('notification');

            returnPartsButton.addEventListener('click', function () {
                switchScreen('returnParts');
            });

            auditPartsButton.addEventListener('click', function () {
                switchScreen('auditParts');
            });

            function switchScreen(screen) {
                mainScreen.classList.add('hidden');
                returnPartsScreen.classList.add('hidden');
                auditPartsScreen.classList.add('hidden');

                if (screen === 'returnParts') {
                    returnPartsScreen.classList.remove('hidden');
                    initScanner('qr-reader', onScanSuccess);
                } else if (screen === 'auditParts') {
                    auditPartsScreen.classList.remove('hidden');
                    initScanner('qr-reader-audit', onScanAuditSuccess);
                }
            }

            function initScanner(elementId, scanSuccessCallback) {
                if (html5QrCode) {
                    html5QrCode.stop().then(() => {
                        html5QrCode.clear();
                        html5QrCode = null;
                        startScanner(elementId, scanSuccessCallback);
                    }).catch(err => {
                        console.error('Error stopping scanner:', err);
                    });
                } else {
                    startScanner(elementId, scanSuccessCallback);
                }
            }

            function startScanner(elementId, scanSuccessCallback) {
                html5QrCode = new Html5Qrcode(elementId);
                html5QrCode.start(
                    { facingMode: "environment" },
                    html5QrCodeConfig,
                    scanSuccessCallback,
                    onScanError
                ).catch(err => {
                    console.error('Error starting scanner:', err);
                    alert('Error starting scanner. Please try again.');
                });
            }

            function onScanSuccess(decodedText) {
                if (!scannedItems.has(decodedText)) {
                    scannedItems.add(decodedText);
                    addItemToList(decodedText);
                    playBeep();
                    showNotification();
                } else {
                    console.log('Item already scanned:', decodedText);
                }
            }

            function onScanAuditSuccess(decodedText) {
                const data = parseAuditData(decodedText);
                if (data) {
                    document.getElementById('customer').value = data.customer;
                    document.getElementById('part').value = data.part;
                    document.getElementById('supplier').value = data.supplier;
                    document.getElementById('order').value = data.order;
                    document.getElementById('labeled').value = data.labeled;
                } else {
                    alert('Invalid QR code format for audit.');
                }
            }

            function onScanError(error) {
                console.warn(`QR error: ${error}`);
            }

            function parseAuditData(decodedText) {
                const data = {};
                const regex = /CUSTOMER=(.*);PART=(.*);SUPPLIER=(.*);ORDER=(.*);LABELED=(.*);/;
                const match = decodedText.match(regex);
                if (match) {
                    data.customer = match[1];
                    data.part = match[2];
                    data.supplier = match[3];
                    data.order = match[4];
                    data.labeled = match[5];
                    return data;
                }
                return null;
            }

            addItemButton.addEventListener('click', function () {
                const customer = document.getElementById('customer').value;
                const part = document.getElementById('part').value;
                const supplier = document.getElementById('supplier').value;
                const order = document.getElementById('order').value;
                const labeled = document.getElementById('labeled').value;
                const location = document.getElementById('location').value;

                if (!customer || !part || !supplier || !order || !labeled || !location) {
                    alert('Please fill in all fields.');
                    return;
                }

                const item = {
                    customer,
                    part,
                    supplier,
                    order,
                    labeled,
                    location
                };

                const li = document.createElement('li');
                li.dataset.item = JSON.stringify(item);
                li.innerHTML = `
                    <div>Customer: ${customer}</div>
                    <div>Part: ${part}</div>
                    <div>Supplier: ${supplier}</div>
                    <div>Order: ${order}</div>
                    <div>Labeled: ${labeled}</div>
                    <div>Location: ${location}</div>
                    <div class="edit-remove-buttons">
                        <button class="edit-button">Edit</button>
                        <button class="remove-button">Remove</button>
                    </div>
                `;
                auditList.appendChild(li);

                li.querySelector('.edit-button').addEventListener('click', () => editItem(li));
                li.querySelector('.remove-button').addEventListener('click', () => removeItem(li));
            });

            function editItem(li) {
                const item = JSON.parse(li.dataset.item);
                document.getElementById('customer').value = item.customer;
                document.getElementById('part').value = item.part;
                document.getElementById('supplier').value = item.supplier;
                document.getElementById('order').value = item.order;
                document.getElementById('labeled').value = item.labeled;
                document.getElementById('location').value = item.location;
                li.remove();
            }

            function removeItem(li) {
                li.remove();
            }

            sortLocationButton.addEventListener('click', function () {
                sortList(auditList, 'location');
            });

            sortDateButton.addEventListener('click', function () {
                sortList(auditList, 'labeled');
            });

            emailAuditButton.addEventListener('click', function () {
                sendAuditEmailReport();
            });

            function sortList(list, key) {
                const items = Array.from(list.children);
                items.sort((a, b) => {
                    const itemA = JSON.parse(a.dataset.item);
                    const itemB = JSON.parse(b.dataset.item);
                    if (itemA[key] < itemB[key]) return -1;
                    if (itemA[key] > itemB[key]) return 1;
                    return 0;
                });
                items.forEach(item => list.appendChild(item));
            }

            function playBeep() {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);

                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            }

            function showNotification() {
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 2000);
            }
        });
    </script>
</body>
</html>
